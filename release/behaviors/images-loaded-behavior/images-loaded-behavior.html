<link rel="import" href="../../polymer/polymer.html"><link rel="import" href="../event-emitter-behavior/event-emitter-behavior.html"><!--
    <images-loaded-behavior>`element <text>.

    Example:
        <images-loaded-behavior></images-loaded-behavior>

    @element images-loaded-behavior
    @demo demo/index.html
--><script>"use strict";function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function _inherits(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}var _createClass=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),GrowCssLoadingImage=function(a){function b(a){_classCallCheck(this,b);var c=_possibleConstructorReturn(this,Object.getPrototypeOf(b).call(this));return c.image=a,c}return _inherits(b,a),_createClass(b,[{key:"check",value:function(){var a=this.isImageComplete(),b=this.image;if(a)return void this.confirm(0!==b.naturalWidth,"naturalWidth");this.proxyImage=new Image;var c=this.proxyImage;c.addEventListener("load",this),c.addEventListener("error",this),b.addEventListener("load",this),b.addEventListener("error",this),c.src=b.src}},{key:"isImageComplete",value:function(){var a=this.image;return a.complete&&void 0!==a.naturalWidth}},{key:"confirm",value:function(a,b){this.isloaded=a,this.emit("progress",this,this.image,b)}},{key:"handleEvent",value:function(a){var b="on"+a.type;this[b]&&this[b](a)}},{key:"onload",value:function(){this.confirm(!0,"onload"),this.unbindEvents()}},{key:"onerror",value:function(){this.confirm(!1,"onerror"),this.unbindEvents()}},{key:"unbindEvents",value:function(){var a=this.image,b=this.proxyImage;b.removeEventListener("load",this),b.removeEventListener("error",this),a.removeEventListener("load",this),a.removeEventListener("error",this)}}]),b}(GrowCssEventEmitter);
  "use strict";function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function _inherits(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}var _createClass=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),GrowCssBackground=function(a){function b(a,c){_classCallCheck(this,b);var d=_possibleConstructorReturn(this,Object.getPrototypeOf(b).call(this));return d["background-image-url"]=a,d["background-image-element"]=c,d["background-image-image"]=new Image,d}return _inherits(b,a),_createClass(b,[{key:"check",value:function(){var a=this["background-image-image"];a.addEventListener("load",this),a.addEventListener("error",this),a.src=this.url;var b=this.getIsImageComplete();b&&(this.confirm(0!==a.naturalWidth,"naturalWidth"),this.unbindEvents())}},{key:"unbindEvents",value:function(){var a=this["background-image-image"];a.removeEventListener("load",this),a.removeEventListener("error",this)}},{key:"confirm",value:function(a,b){this.isloaded=a,this.emit("progress",this,this["background-image-element"],b)}}]),b}(GrowCssLoadingImage);
  "use strict";function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function _inherits(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}var _createClass=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),GrowCss=GrowCss||{},GrowCssImagesLoaded=function(a){function b(a,c,d){_classCallCheck(this,b);var e=_possibleConstructorReturn(this,Object.getPrototypeOf(b).call(this)),f=a,g=d;return null===f?_possibleConstructorReturn(e):(e.options={},"string"==typeof f&&(f=e.querySelectorAll(f)),e.elements=e.createArray(f),"function"==typeof c?g=c:e.options=c,g&&e.listen("always",g),e.getImages(),setTimeout(e.check()),e)}return _inherits(b,a),_createClass(b,[{key:"getImages",value:function(){this.images=[],this.elements.forEach(this.addElementImages,this)}},{key:"addElementImages",value:function(a){var b=a,c=b.nodeType,d=b.querySelectorAll("img"),e={1:!0,9:!0,11:!0},f=0;if("IMG"===b.nodeName&&this.addImage(b),this.options.background===!0&&this.addElementBackgroundImages(b),c&&e[c]){for(;f<d.length;f++)this.addImage(d[f]);if("string"==typeof this.options.background){var g=b.querySelectorAll(this.options.background);for(f=0;f<g.length;f++){var h=g[f];this.addElementBackgroundImages(h)}}}}},{key:"addElementBackgroundImages",value:function(a){var b=a,c=getComputedStyle(b);if(c)for(var d=/url\((['"])?(.*?)\1\)/gi,e=d.exec(c.backgroundImage);null!==e;){var f=e&&e[2];f&&this.addBackground(f,b),e=d.exec(c.backgroundImage)}}},{key:"addImage",value:function(a){var b=new GrowCssLoadingImage(a);this.images.push(b)}},{key:"addBackground",value:function(a,b){var c=new GrowCssBackground(a,b);this.images.push(c)}},{key:"check",value:function(){var a=this,b=this.images;if(this["progressed-count"]=0,this["has-any-broken"]=!1,!b.length)return void this.complete();var c=function(b,c,d){setTimeout(function(){a.progress(b,c,d)})};b.forEach(function(a){a.once("progress",c),a.check()})}},{key:"progress",value:function(a,b,c){var d=this.images;this["progressed-count"]++,this["has-any-broken"]=this["has-any-broken"]||!a.isLoaded,this.emit("progress",this,a,b),this["progressed-count"]===d.length&&this.complete(),this.options.debug&&console.log("progress: "+c,a,b)}},{key:"complete",value:function(){var a=this["has-any-broken"]?"fail":"done";this.isComplete=!0,this.emit(a,this),this.emit("always",this)}},{key:"createArray",value:function(a){var b=[],c=0;if(Array.isArray(a))b=a;else if("number"==typeof a.length)for(;c<a.length;c++)b.push(a[c]);else b.push(a);return b}}]),b}(GrowCssEventEmitter),GcImagesLoaded={hasImagesLoaded:function(a,b,c){return new GrowCssImagesLoaded(a,b,c)}};GrowCss.ImagesLoadedBehavior=GcImagesLoaded;</script>